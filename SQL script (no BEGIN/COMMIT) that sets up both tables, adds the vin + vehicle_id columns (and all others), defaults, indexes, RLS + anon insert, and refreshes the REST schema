-- Simple config table: one row per device_id storing VIN
create table if not exists public.devices (
  device_id text primary key,
  vin text
);

-- RLS: allow anon read/write (device uses anon key).
alter table public.devices enable row level security;

drop policy if exists devices_select_anon on public.devices;
create policy devices_select_anon
  on public.devices for select to anon using (true);

drop policy if exists devices_insert_anon on public.devices;
create policy devices_insert_anon
  on public.devices for insert to anon with check (true);

drop policy if exists devices_update_anon on public.devices;
create policy devices_update_anon
  on public.devices for update to anon using (true);

select pg_notify('pgrst','reload schema');

